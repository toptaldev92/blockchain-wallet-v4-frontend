language:
  - node_js
node_js:
  - 9.5
cache:
  directories:
    - node_modules
    - packages/blockchain-info-components/node_modules
    - packages/blockchain-wallet-v4/node_modules
    - packages/blockchain-wallet-v4-frontend/node_modules
before_install:
  - npm install -g lerna yarn
install:
  - yarn && lerna bootstrap
script:
  - if [ $TRAVIS_EVENT_TYPE == "push" ] && [ $TRAVIS_BRANCH == "master" ]; then
      echo "*** RUNNING FULL BUILD ***";
      echo "*** LINT ***";
      yarn lint;
      echo "*** UNIT TESTS W/ COVERAGE ***";
      yarn ci:coverage;
      echo "*** REPORTING COVERAGE ***";
      ./node_modules/.bin/istanbul-coveralls;
      echo "*** BUILD PROD ***";
      yarn ci:build:prod;
    else
      echo "*** RUNNING QUICK BUILD ***";
      echo "*** LINT ***";
      yarn lint;
      echo "*** UNIT TESTS ***";
      yarn ci:test;
      echo "*** BUILD DEV ***";
      yarn ci:build;
    fi
before_deploy:
  - if [ $TRAVIS_EVENT_TYPE == "push" ] && [ $TRAVIS_BRANCH == "master" ]; then
      echo "*** ZIP ARTIFACTS ***";
      zip -r build.zip ./dist
    fi
deploy:
  - echo "*** DEPLOY ***";
